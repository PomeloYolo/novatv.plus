<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IP 訪問受限 - NovaTV</title>
    <script src="libs/tailwindcss.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #0f172a;
            color: #f1f5f9;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">
    <div class="max-w-md p-8 mx-auto bg-slate-800 rounded-lg shadow-lg text-center">
        <img src="image/logo.png" alt="NovaTV Logo" class="w-32 mx-auto mb-6">
        
        <h1 class="mb-4 text-2xl font-bold text-red-500">訪問受限 / Access Denied</h1>
        
        <div class="mb-6 text-slate-300">
            <p class="mb-2">對不起，您的IP地址無法使用NovaTV。如需詳細資訊請聯繫管理員！</p>
            <p>Sorry, your IP address is not authorized to use NovaTV. Please contact the administrator for more information!</p>
        </div>
        
        <div class="p-4 mb-4 text-sm bg-slate-700 rounded">
            <p class="text-yellow-400" id="ip-display">正在檢查您的IP地址... / Checking your IP address...</p>
        </div>
        
        <a href="index.html" class="inline-block px-4 py-2 text-white bg-blue-600 rounded hover:bg-blue-700">
            重新載入
        </a>
    </div>

    <script>
        // 顯示客戶端IP和診斷信息
        function showIPInfo() {
            // 從sessionStorage獲取IP信息
            const blockedIP = sessionStorage.getItem('blockedIP') || '未知';
            let whitelistText = '';
            
            try {
                const whitelist = JSON.parse(sessionStorage.getItem('ipWhitelist') || '[]');
                whitelistText = whitelist.join(', ') || '無數據';
            } catch (e) {
                whitelistText = '無法讀取白名單';
            }
            
            // 顯示IP信息
            document.getElementById('ip-display').innerHTML = 
                `您的IP地址 / Your IP: <span class="font-bold text-white">${blockedIP}</span><br>` +
                `<span class="text-xs mt-2 block">請將此IP提供給管理員以獲取授權 / Please provide this IP to administrator for authorization</span>`;
            
            // 添加一個調試按鈕
            const debugButton = document.createElement('button');
            debugButton.className = 'mt-2 text-xs text-gray-400 underline';
            debugButton.textContent = '顯示診斷信息 / Show diagnostic info';
            debugButton.onclick = function() {
                const debugInfo = document.createElement('div');
                debugInfo.className = 'mt-2 text-xs text-left text-gray-400';
                debugInfo.innerHTML = `
                    <p class="mb-1">白名單IP / Whitelist IPs:</p>
                    <p class="mb-2 pl-2">${whitelistText}</p>
                    <p class="mb-1">如何解決 / How to fix:</p>
                    <p class="pl-2">1. 請管理員將您的IP添加到白名單 / Ask admin to add your IP to whitelist</p>
                    <p class="pl-2">2. 如果您使用VPN，請嘗試關閉 / If using VPN, try turning it off</p>
                `;
                this.parentNode.replaceChild(debugInfo, this);
            };
            document.getElementById('ip-display').appendChild(debugButton);
        }
        
        // 如果沒有從sessionStorage獲取到IP，則嘗試從API獲取
        async function fetchIPIfNeeded() {
            if (!sessionStorage.getItem('blockedIP')) {
                try {
                    const response = await fetch('https://api.ipify.org?format=json');
                    const data = await response.json();
                    sessionStorage.setItem('blockedIP', data.ip);
                } catch (error) {
                    console.error('Error getting IP:', error);
                }
            }
            showIPInfo();
        }
        
        document.addEventListener('DOMContentLoaded', fetchIPIfNeeded);
    </script>
</body>
</html>
